===
smf
===

.. contents::

Example
=======

簡単なMIDIファイルをこのライブラリを使って作成してみる。
以下はMIDIファイルでを16進数ダンプしたもの。

:: 

   (*'-')! › xxd tests/test.mid 
   00000000: 4d54 6864 0000 0006 0000 0001 01e0 4d54  MThd..........MT
   00000010: 726b 0000 00a0 0090 3164 7880 3100 0090  rk......1dx.1...
   00000020: 3264 7880 3200 0090 3364 7880 3300 0090  2dx.2...3dx.3...
   00000030: 3464 7880 3400 0090 3564 7880 3500 0090  4dx.4...5dx.5...
   00000040: 3664 7880 3600 0090 3764 7880 3700 0090  6dx.6...7dx.7...
   00000050: 3864 7880 3800 0090 3964 7880 3900 0090  8dx.8...9dx.9...
   00000060: 3a64 7880 3a00 0090 3b64 7880 3b00 0090  :dx.:...;dx.;...
   00000070: 3c64 7880 3c00 0090 3d64 7880 3d00 0090  <dx.<...=dx.=...
   00000080: 3e64 7880 3e00 0090 3f64 7880 3f00 0090  >dx.>...?dx.?...
   00000090: 4064 7880 4000 0090 4164 7880 4100 0090  @dx.@...Adx.A...
   000000a0: 4264 7880 4200 0090 4364 7880 4300 0090  Bdx.B...Cdx.C...
   000000b0: 4464 7880 4400 ff2f 00                   Ddx.D../.

これらをそれぞれヘッダチャンクとトラックチャンクに分解してみる。

ヘッダチャンク
--------------

ヘッダチャンクは以下の部分。

::

   (*'-')! › xxd tests/test.mid 
   00000000: 4d54 6864 0000 0006 0000 0001 01e0       MThd..........

上記のデータを分解すると以下の通り。

=========== ========== =========== ==================================
Genre       ByteLength Value       説明・補足
=========== ========== =========== ==================================
ChunkType   4 byte     4d 54 68 64
DataLength  4 byte     00 00 00 06 6 byte （ビッグエンディアンなので）
Format      2 byte     00 00
TrackCount  2 byte     00 01
TimeUnit    2 byte     01 e0
=========== ========== =========== ==================================

トラックチャンク
--------------

トラックチャンクは以下の部分。

::

   (*'-')! › xxd tests/test.mid 
                                                4d54                MT
   00000010: 726b 0000 00a0 0090 3164 7880 3100 0090  rk......1dx.1...
   00000020: 3264 7880 3200 0090 3364 7880 3300 0090  2dx.2...3dx.3...
   00000030: 3464 7880 3400 0090 3564 7880 3500 0090  4dx.4...5dx.5...
   00000040: 3664 7880 3600 0090 3764 7880 3700 0090  6dx.6...7dx.7...
   00000050: 3864 7880 3800 0090 3964 7880 3900 0090  8dx.8...9dx.9...
   00000060: 3a64 7880 3a00 0090 3b64 7880 3b00 0090  :dx.:...;dx.;...
   00000070: 3c64 7880 3c00 0090 3d64 7880 3d00 0090  <dx.<...=dx.=...
   00000080: 3e64 7880 3e00 0090 3f64 7880 3f00 0090  >dx.>...?dx.?...
   00000090: 4064 7880 4000 0090 4164 7880 4100 0090  @dx.@...Adx.A...
   000000a0: 4264 7880 4200 0090 4364 7880 4300 0090  Bdx.B...Cdx.C...
   000000b0: 4464 7880 4400 ff2f 00                   Ddx.D../.

上記のデータを分解すると以下の通り。

=========== ========== =========== ==================================
Genre       ByteLength Value       説明・補足
=========== ========== =========== ==================================
ChunkType   4 byte     4d 54 72 6b -
DataLength  4 byte     00 00 00 a0 160 byte （ビッグエンディアンなので）
DataBody    n byte     -           後述
=========== ========== =========== ==================================

Databody
^^^^^^^^

+------------+------------+-------------+-----------------------+
| genre      | data (hex) | type        | description           |
+============+============+=============+=======================+
| delta time | 00         | delta time  | 0                     |
+------------+------------+-------------+-----------------------+
| midi event | 90         | midi event  | note on, channel = 0  |
+------------+------------+-------------+-----------------------+
|            | 31         | note number | 49 (10)               |
+------------+------------+-------------+-----------------------+
|            | 64         | velocity    | 100 (10)              |
+------------+------------+-------------+-----------------------+
| delta time | 78         | delta time  | 120                   |
+------------+------------+-------------+-----------------------+
| midi event | 80         | midi event  | note off, channel = 0 |
+------------+------------+-------------+-----------------------+
|            | 31         | note number | 49 (10)               |
+------------+------------+-------------+-----------------------+
|            | 00         | velocity    | 0 (10)                |
+------------+------------+-------------+-----------------------+
